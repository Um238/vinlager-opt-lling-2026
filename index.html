<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CellarCount 2026 - Vinlager Opt√¶lling</title>
      <link rel="stylesheet" href="styles.css?v=18">
      <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
      <meta http-equiv="Pragma" content="no-cache">
      <meta http-equiv="Expires" content="0">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
  <header>
    <h1>üç∑ CellarCount 2026</h1>
    <nav>
      <button class="nav-btn active" data-page="dashboard">Dashboard</button>
      <button class="nav-btn" data-page="lager">Lager</button>
      <button class="nav-btn" data-page="opt√¶lling">Opt√¶lling</button>
      <button class="nav-btn" data-page="import">Import</button>
      <button class="nav-btn" data-page="labels">Labels</button>
      <button class="nav-btn" data-page="rapporter">Rapporter</button>
    </nav>
  </header>

  <main>
    <!-- Dashboard -->
    <section id="dashboard" class="page active">
      <div class="card">
        <h2>Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card clickable" onclick="showVineOversigt('alle')">
            <div class="stat-label">Antal vine</div>
            <div class="stat-value" id="stat-ant-vine">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Samlet lagerv√¶rdi</div>
            <div class="stat-value" id="stat-v√¶rdi">0 kr.</div>
          </div>
          <div class="stat-card clickable" onclick="showVineOversigt('lavt')">
            <div class="stat-label">Lavt lager</div>
            <div class="stat-value warning" id="stat-lavt">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Lager -->
    <section id="lager" class="page">
      <div class="card">
        <h2>Lageroversigt</h2>
        <div class="filter-bar">
          <select id="filter-reol">
            <option value="">Alle reoler</option>
          </select>
          <select id="filter-hylde">
            <option value="">Alle hylder</option>
          </select>
          <button class="btn-secondary" onclick="applyFilter()">Filtrer</button>
          <button class="btn-secondary" onclick="clearFilter()">Ryd</button>
        </div>
        <div class="table-container">
          <table id="lager-table">
            <thead>
              <tr>
                <th>Varenummer</th>
                <th>Navn</th>
                <th>Type</th>
                <th>Land</th>
                <th>Region</th>
                <th>√Örgang</th>
                <th>Reol</th>
                <th>Hylde</th>
                <th class="text-right">Antal</th>
                <th class="text-right">Min.</th>
                <th class="text-right">Pris</th>
                <th>Billede</th>
              </tr>
            </thead>
            <tbody id="lager-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Opt√¶lling -->
    <section id="opt√¶lling" class="page">
      <div class="card">
        <h2>QR-kode Opt√¶lling</h2>
        <div class="scan-container">
          <div class="scan-section">
            <label>Scan eller indtast QR-kode (VIN-ID eller Varenummer):</label>
            <div style="position: relative;">
              <input type="text" id="scan-input" placeholder="VIN-0001 eller W001" autofocus>
              <div id="autocomplete-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 2px;"></div>
            </div>
            <button class="btn-primary" onclick="scanQR()">S√∏g vin</button>
            <button class="btn-secondary" id="start-camera-btn" onclick="startQRScanner()" style="margin-left: 10px;">üì∑ Start kamera scanner</button>
            <video id="qr-video" style="width: 100%; max-width: 400px; display: none; margin-top: 10px;"></video>
            <canvas id="qr-canvas" style="display: none;"></canvas>
          </div>

          <div id="wine-details" class="wine-details" style="display: none;">
            <h3 id="wine-navn"></h3>
            <div class="wine-info">
              <div><strong>VIN-ID:</strong> <span id="wine-vinId"></span></div>
              <div><strong>Type:</strong> <span id="wine-type"></span></div>
              <div><strong>Land:</strong> <span id="wine-land"></span></div>
              <div><strong>Region:</strong> <span id="wine-region"></span></div>
              <div><strong>√Örgang:</strong> <span id="wine-√•rgang"></span></div>
              <div><strong>Reol:</strong> <span id="wine-reol"></span> | <strong>Hylde:</strong> <span id="wine-hylde"></span></div>
              <div><strong>Nuv√¶rende antal:</strong> <span id="wine-antal" class="big-number"></span></div>
              <div id="wine-billede-container"></div>
            </div>

            <div class="count-controls">
              <h4>Opdater antal:</h4>
              <div class="count-buttons">
                <button class="btn-count" onclick="updateCount(-1)">-1</button>
                <button class="btn-count" onclick="updateCount(-5)">-5</button>
                <input type="number" id="count-input" placeholder="Direkte antal" style="width: 150px; padding: 10px;">
                <button class="btn-count" onclick="updateCount(5)">+5</button>
                <button class="btn-count" onclick="updateCount(1)">+1</button>
              </div>
              <button class="btn-primary" onclick="saveCount()">Gem antal</button>
              <div id="count-status"></div>
            </div>
          </div>

          <div id="scan-error" class="error-message" style="display: none;"></div>
        </div>
      </div>
    </section>

    <!-- Import -->
    <section id="import" class="page">
      <div class="card">
        <h2>Import CSV/Excel</h2>
        <div class="import-section">
          <p>V√¶lg import-mode:</p>
          <div class="radio-group">
            <label><input type="radio" name="import-mode" value="overskriv" checked> Overskriv hele lageret</label>
            <label><input type="radio" name="import-mode" value="tilf√∏j"> Tilf√∏j nye vine (spring eksisterende over)</label>
            <label><input type="radio" name="import-mode" value="opdater"> Opdat√©r eksisterende vine</label>
          </div>

          <div class="file-upload">
            <label for="file-input" class="file-label">
              <span>V√¶lg CSV eller Excel fil</span>
              <input type="file" id="file-input" accept=".csv,.xlsx,.xls" style="display: none;">
            </label>
            <span id="file-name"></span>
          </div>

          <button class="btn-primary" onclick="doImport()">Start import</button>

          <div id="import-results" style="display: none;">
            <h3>Import resultat:</h3>
            <div id="import-results-content"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Labels -->
    <section id="labels" class="page">
      <div class="card">
        <h2 class="sticky-header">Print Labels</h2>
        <div class="filter-bar">
          <select id="label-reol">
            <option value="">Alle reoler</option>
          </select>
          <select id="label-hylde">
            <option value="">Alle hylder</option>
          </select>
          <button class="btn-secondary" onclick="generateLabels()">Generer labels</button>
          <button class="btn-print" onclick="printLabels()">üñ®Ô∏è Print labels</button>
        </div>
        <div id="labels-container" class="labels-container"></div>
      </div>
    </section>

    <!-- Rapporter -->
    <section id="rapporter" class="page">
      <div class="card">
        <h2>Rapporter</h2>
        <p style="color: #666; margin-bottom: 1rem;">Se og administrer rapporter og arkiverede rapporter.</p>
        
        <!-- Filtre -->
        <div class="filter-bar" style="margin-bottom: 1rem;">
          <label style="margin-right: 1rem;">
            <strong>V√¶lg periode:</strong>
            <select id="report-period" onchange="renderReportsTable()" style="margin-left: 0.5rem; padding: 0.5rem;">
              <option value="all">Alle Rapporter</option>
              <option value="today">I dag</option>
              <option value="week">Sidste uge</option>
              <option value="thisMonth">Denne m√•ned</option>
              <option value="lastMonth">Sidste m√•ned</option>
            </select>
          </label>
          <label style="margin-right: 1rem;">
            <strong>V√¶lg lokation:</strong>
            <select id="report-location" onchange="renderReportsTable()" style="margin-left: 0.5rem; padding: 0.5rem;">
              <option value="all">Alle</option>
            </select>
          </label>
        </div>

        <!-- Generer nye rapporter -->
        <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 4px;">
          <h3 style="margin-bottom: 0.5rem;">Generer ny rapport:</h3>
          <button class="btn-primary" onclick="generateLagerReport()" style="margin-right: 0.5rem;">Lagerrapport (PDF)</button>
          <button class="btn-primary" onclick="generateV√¶rdiReport()">V√¶rdirapport (PDF)</button>
        </div>

        <!-- Rapport liste -->
        <div id="reports-list">
          <div style="margin-bottom: 0.5rem;">
            <strong>Vis alle rapporter:</strong>
            <button class="btn-secondary" onclick="generateLavStatusRapport()" style="margin-left: 0.5rem;">Lav status rapport</button>
          </div>
          
          <table id="reports-table" style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">
                <th style="padding: 0.75rem; text-align: left;">Dato / Tid</th>
                <th style="padding: 0.75rem; text-align: left;">Handling (Rapport navn)</th>
                <th style="padding: 0.75rem; text-align: left;">Vare / Note</th>
                <th style="padding: 0.75rem; text-align: left;">Antal varer</th>
                <th style="padding: 0.75rem; text-align: left;">Lokation</th>
                <th style="padding: 0.75rem; text-align: left;">Handlinger</th>
              </tr>
            </thead>
            <tbody id="reports-tbody">
              <!-- Rapporter indl√¶ses her -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

      <script>
        // Force reload - clear all caches
        const CACHE_VERSION = 'v24_' + Date.now();
        console.log('========================================');
        console.log('=== INDEX.HTML LOADING ===');
        console.log('Cache version:', CACHE_VERSION);
        console.log('Timestamp:', new Date().toISOString());
        if ('caches' in window) {
          caches.keys().then(names => {
            console.log('Clearing caches:', names.length);
            names.forEach(name => caches.delete(name));
          });
        }
        console.log('Loading config.js and app.js v24...');
        console.log('========================================');
      </script>
      <script src="config.js?v=24"></script>
      <script>
        console.log('Config loaded, now loading app.js...');
      </script>
      <script src="app.js?v=24"></script>
    </main>

    <!-- Modal for vine oversigt -->
    <div id="vine-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title">Vine Oversigt</h2>
          <span class="modal-close" onclick="closeVineModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div id="modal-stats" style="margin-bottom: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 4px;">
            <!-- Stats vises her -->
          </div>
          <div class="table-container">
            <table id="modal-vine-table">
              <thead>
                <tr>
                  <th>Navn</th>
                  <th>Type</th>
                  <th>Land</th>
                  <th>Reol</th>
                  <th>Hylde</th>
                  <th>Antal</th>
                  <th>Min.</th>
                </tr>
              </thead>
              <tbody id="modal-vine-tbody">
                <!-- Vine vises her -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" onclick="closeVineModal()">Luk</button>
        </div>
      </div>
    </div>
      <script>
        console.log('All scripts should be loaded now. Check console for errors.');
      </script>
</body>
</html>
